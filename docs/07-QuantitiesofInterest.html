<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MLE 2023 - 7&nbsp; Quantities of Interest</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-OrdinalandOutcomes.html" rel="next">
<link href="./06-BinaryOutcomes.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-QuantitiesofInterest.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Quantities of Interest</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MLE 2023</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Maxmimum Likelihood Fall 2023</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-ROverview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-TheMATH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The Math</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-ReviewofOLS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Review of OLS</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-IntrotoMaximumLikelihood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to MLE</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-BinaryOutcomes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Binary Dependent Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-QuantitiesofInterest.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Quantities of Interest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-OrdinalandOutcomes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Ordinal Outcomes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-NominalOutcomes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Multinomial Outcomes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-CountData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Count data</span></span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Section Contents</h2>
   
  <ul>
  <li><a href="#using-the-response-functions-to-generate-quantities-of-interest" id="toc-using-the-response-functions-to-generate-quantities-of-interest" class="nav-link active" data-scroll-target="#using-the-response-functions-to-generate-quantities-of-interest"><span class="header-section-number">7.1</span> Using the response functions to generate quantities of interest</a></li>
  <li><a href="#qoi-at-designated-values" id="toc-qoi-at-designated-values" class="nav-link" data-scroll-target="#qoi-at-designated-values"><span class="header-section-number">7.2</span> QOI at Designated Values</a>
  <ul>
  <li><a href="#marginal-effects" id="toc-marginal-effects" class="nav-link" data-scroll-target="#marginal-effects"><span class="header-section-number">7.2.1</span> Marginal Effects</a></li>
  <li><a href="#marginal-effects-at-the-mean" id="toc-marginal-effects-at-the-mean" class="nav-link" data-scroll-target="#marginal-effects-at-the-mean"><span class="header-section-number">7.2.2</span> Marginal effects at the mean</a></li>
  <li><a href="#marginal-effects-at-representative-values" id="toc-marginal-effects-at-representative-values" class="nav-link" data-scroll-target="#marginal-effects-at-representative-values"><span class="header-section-number">7.2.3</span> Marginal effects at representative values</a></li>
  <li><a href="#average-marginal-effects" id="toc-average-marginal-effects" class="nav-link" data-scroll-target="#average-marginal-effects"><span class="header-section-number">7.2.4</span> Average marginal effects</a></li>
  <li><a href="#marginaleffects-prediction-and-margins-packages." id="toc-marginaleffects-prediction-and-margins-packages." class="nav-link" data-scroll-target="#marginaleffects-prediction-and-margins-packages."><span class="header-section-number">7.2.5</span> <code>marginaleffects</code>, <code>prediction</code> and <code>margins</code> packages.</a>
  <ul class="collapse">
  <li><a href="#marginaleffects" id="toc-marginaleffects" class="nav-link" data-scroll-target="#marginaleffects"><span class="header-section-number">7.2.5.1</span> <code>marginaleffects</code></a></li>
  <li><a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction"><span class="header-section-number">7.2.5.2</span> <code>prediction</code></a></li>
  </ul></li>
  <li><a href="#qoi-practice-problems" id="toc-qoi-practice-problems" class="nav-link" data-scroll-target="#qoi-practice-problems"><span class="header-section-number">7.2.6</span> QOI Practice Problems</a></li>
  </ul></li>
  <li><a href="#uncertainty" id="toc-uncertainty" class="nav-link" data-scroll-target="#uncertainty"><span class="header-section-number">7.3</span> Uncertainty</a>
  <ul>
  <li><a href="#bootstrapping" id="toc-bootstrapping" class="nav-link" data-scroll-target="#bootstrapping"><span class="header-section-number">7.3.1</span> Bootstrapping</a></li>
  <li><a href="#simulated-confidence-intervals" id="toc-simulated-confidence-intervals" class="nav-link" data-scroll-target="#simulated-confidence-intervals"><span class="header-section-number">7.3.2</span> Simulated Confidence Intervals</a></li>
  </ul></li>
  <li><a href="#visualizing-results" id="toc-visualizing-results" class="nav-link" data-scroll-target="#visualizing-results"><span class="header-section-number">7.4</span> Visualizing Results</a></li>
  <li><a href="#additional-r-shortcuts" id="toc-additional-r-shortcuts" class="nav-link" data-scroll-target="#additional-r-shortcuts"><span class="header-section-number">7.5</span> Additional R shortcuts</a>
  <ul>
  <li><a href="#marginaleffects-1" id="toc-marginaleffects-1" class="nav-link" data-scroll-target="#marginaleffects-1"><span class="header-section-number">7.5.1</span> marginaleffects</a></li>
  <li><a href="#prediction-1" id="toc-prediction-1" class="nav-link" data-scroll-target="#prediction-1"><span class="header-section-number">7.5.2</span> Prediction</a></li>
  <li><a href="#margins" id="toc-margins" class="nav-link" data-scroll-target="#margins"><span class="header-section-number">7.5.3</span> Margins</a></li>
  <li><a href="#using-expand.grid" id="toc-using-expand.grid" class="nav-link" data-scroll-target="#using-expand.grid"><span class="header-section-number">7.5.4</span> Using <code>expand.grid</code></a></li>
  </ul></li>
  <li><a href="#quantities-of-interest-tutorial" id="toc-quantities-of-interest-tutorial" class="nav-link" data-scroll-target="#quantities-of-interest-tutorial"><span class="header-section-number">7.6</span> Quantities of Interest Tutorial</a></li>
  <li><a href="#putting-everything-together" id="toc-putting-everything-together" class="nav-link" data-scroll-target="#putting-everything-together"><span class="header-section-number">7.7</span> Putting everything together</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="qoi" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Quantities of Interest</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This section will provide information about calculating quantities of interest. Often, in linear regression, our coefficients might directly represent the quantities we are interested in interpreting. However, in other models, we might need to do a bit of work to make it easier on our readers (and ourselves).</p>
<p>The quantities of interest you generate should be directly related to your research question and hypotheses. For example, if my hypothesis was about how the competitiveness of a state is related to the probability that someone is contacted by a campaign, then my quantities of interest would involve a comparison of the predicted probability of campaign contact for those in more vs.&nbsp;less competitive states. In contrast, if my hypothesis was about the number of bills passed in a legislature under unified vs.&nbsp;divided government, I would want to express my quantities of interest as a different in counts of bills or rate of bills pasesed.</p>
<p>We will discuss computing quantities of interest, uncertainty for these quantities, and visualization.</p>
<p>We can take something that looks like column 5 in the table from Antoine Banks and Heather Hicks example from the previous section and move it into a figure, as the authors did.</p>
<p><img src="images/bankstable1.png" class="img-fluid" style="width:40.0%"> <img src="images/abtracefig.png" class="img-fluid" style="width:40.0%"></p>
<p>Here are a few external resources that relate to the concepts discussed in this section.</p>
<ul>
<li>Michael J. Hanmer and Kerem Ozan Kalkan. <a href="http://onlinelibrary.wiley.com/doi/10.1111/j.1540-%205907.2012.00602.x/pdf">Behind the Curve: Clarifying the Best Approach to Calculating Predicted Probabilities and Marginal Effects from limited Dependent Variable Models.</a> American Journal of Political Science.</li>
<li>Why plot results? Jonathan P. Kastellec and Eduardo L. Leoni. <a href="http://www.princeton.edu/~jkastell/Tables2Graphs/graphs.pdf">Using Graphs Instead of Tables in Political Science.</a></li>
<li>Short overviews of the bootstrap method for calculating uncertainty:
<ul>
<li>Pezullo, John. <a href="https://www.dummies.com/education/science/biology/the-bootstrap-method-for-standard-errors-and-confidence-intervals/">The Bootstrap Method for Standard Errors and Confidence Intervals.</a></li>
<li>Banks, David. <a href="http://www2.stat.duke.edu/~banks/111-lectures.dir/lect13.pdf">Lecture from Duke University.</a></li>
</ul></li>
<li>Overview of simulation approach for calculating uncertainty from <a href="https://gking.harvard.edu/files/abs/making-abs.shtml">King, Tomz, and Wittenberg 2000</a>.</li>
<li>R packages helpful for quantities of interest
<ul>
<li>Thomas Leeper: <a href="https://github.com/leeper/prediction">prediction</a> and <a href="https://github.com/leeper/margins">margins</a></li>
</ul></li>
</ul>
<section id="using-the-response-functions-to-generate-quantities-of-interest" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="using-the-response-functions-to-generate-quantities-of-interest"><span class="header-section-number">7.1</span> Using the response functions to generate quantities of interest</h2>
<p>Recall, in linear regression, to get our estimated values <span class="math inline">\(\hat Y\)</span> we said <span class="math inline">\(\hat Y = X\hat\beta\)</span>.</p>
<ul>
<li>In glm’s, we can do the same to get our estimated values on the scale of the linear predictor <span class="math inline">\(\hat \eta = X\hat\beta\)</span>.</li>
<li>We then use our <span class="math inline">\(Link^{-1}\)</span> response function to transform these values into the quantity of interest.
<ul>
<li>E.g., in logistic regression we want <span class="math inline">\(\hat{\pi} = \frac{\exp(X\hat\beta)}{1 + \exp(X\hat\beta)}\)</span>.</li>
<li>E.g., in probit regression we want <span class="math inline">\(\hat{\pi} = \Phi(X \hat \beta)\)</span>.</li>
<li>These represent the predicted probability of <span class="math inline">\(Y_i = 1\)</span> given our coefficient estimates and designated values of the covariates</li>
</ul></li>
</ul>
<p>Let’s use a subset of the MIDs <code>mids.txt</code> data available <a href="https://github.com/ktmccabe/teachingdata">here</a>.</p>
<p>This dataset has variables related to whether a dyad of states is engaged in a militarized interstate dispute between the two countries in a given year. The variable that will be our outcome of interest is <code>Conflict</code> which takes the values 0 or 1. We will also look at the relationship between a few independent variables and the propensity for conflict. Data are at Dyad Level.</p>
<ul>
<li>whether the pair of countries
<ul>
<li>include a major power (<code>MajorPower</code>, 1=yes, 0=otherwise),</li>
<li>are contiguous ( <code>Contiguity</code>, 1=yes, 0=otherwise),</li>
<li>are allies (<code>Allies</code>, 1=yes, 0=otherwise),</li>
<li>and/or have similar foreign policy portfolios (<code>ForeignPolicy</code>, 1=yes, 0=otherwise)</li>
</ul></li>
<li><code>BalanceofPower</code>: balance of military power</li>
<li><code>YearsSince</code>: the number of years since the last dispute</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>mids <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"https://raw.githubusercontent.com/ktmccabe/teachingdata/main/midsshort.txt"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mids<span class="sc">$</span>Conflict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    0     1 
99657   343 </code></pre>
</div>
</div>
<p>As can be seen from the table above, conflicts (fortunately) are relatively rare in our data. This means are predicted probabilities are likely going to be pretty small in this example.</p>
<p>We will run a logistic regression with a few covariates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>out.logit <span class="ot">&lt;-</span><span class="fu">glm</span>(Conflict <span class="sc">~</span>  MajorPower <span class="sc">+</span> Contiguity <span class="sc">+</span> Allies <span class="sc">+</span> ForeignPolicy <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    BalanceOfPower <span class="sc">+</span> YearsSince, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> mids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our logistic regression equation is:</p>
<ul>
<li><span class="math inline">\(\log \frac{\pi_i}{1-\pi_i} = \mathbf{x_i'}\beta\)</span>, or alternatively</li>
<li><span class="math inline">\(Pr(Y_i = 1 | \mathbf{x}_i) = logit^{-1}(\mathbf{x}_i'\beta) = \frac{exp(\mathbf{x_i'}\beta)}{1 + exp(\mathbf{x_i'}\beta)}\)</span></li>
</ul>
<p>Our coefficients are in the “logit” aka log-odds scale of the linear predictor, so we use the response function to put them into probability estimates.</p>
<p>For logistic regression, we can generate predicted probabilities for each <span class="math inline">\(Y_i\)</span> using the</p>
<ol type="1">
<li><code>predict(model, type="response")</code> function, using the</li>
<li><code>plogis</code> function with <span class="math inline">\(X\hat \beta\)</span>, or
<ul>
<li>Question: What would be the equivalent function for probit?</li>
</ul></li>
<li>manually writing down the response function <span class="math inline">\(\frac{exp(\mathbf{x_i'}\beta)}{1 + exp(\mathbf{x_i'}\beta)}\)</span>.</li>
</ol>
<p>We use the <code>predict</code> function exactly the same way as before, but the key argument we need to specify is <code>type</code>. If you have <code>type = link</code> this generates answers that are still on the log-odds linear predictor scale. It is switching this to <code>response</code> that goes into probability in the logit case or probit case.</p>
<p><strong>Example</strong></p>
<p>First, let’s just generate predicted probabilities for each observation in our data, without specifiying any designated values for <span class="math inline">\(X\)</span>– just keeping the values as they are in the data aka “as observed.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Method with predict()</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## When you don't specify newdata, R assumes you want the X data from the model</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">predict</span>(out.logit, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Manual way #1</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(out.logit)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>pplogis <span class="ot">&lt;-</span> <span class="fu">plogis</span>(X <span class="sc">%*%</span> bh)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Manual way # 2</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>ppexp <span class="ot">&lt;-</span> <span class="fu">exp</span>(X <span class="sc">%*%</span> bh)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(X <span class="sc">%*%</span> bh))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare the first five rows of each to see they are the same</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(pplogis, ppexp, pp)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                           pp
78627  0.0004204501 0.0004204501 0.0004204501
295818 0.0001035526 0.0001035526 0.0001035526
251841 0.0006211178 0.0006211178 0.0006211178
98068  0.0004270812 0.0004270812 0.0004270812
209797 0.0001005396 0.0001005396 0.0001005396</code></pre>
</div>
</div>
<p>The code above generates a predicted probability associated with each observation in the data. This is similar to generating a fitted value <span class="math inline">\(\hat y\)</span> for each observation in OLS.</p>
</section>
<section id="qoi-at-designated-values" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="qoi-at-designated-values"><span class="header-section-number">7.2</span> QOI at Designated Values</h2>
<p>Usually in social science we have hypotheses about how the predicted probabilities change as one or more of our independent variables change. We will now turn to calculating predicted responses according to specific values of the independent variables.</p>
<p>Recall, sometimes in linear regression, we wanted to calculate a specific estimated value of <span class="math inline">\(\hat Y_i\)</span> for when we set <span class="math inline">\(X\)</span> at particular values. (e.g., What value do we estimate for <span class="math inline">\(Y\)</span> when <span class="math inline">\(X1 = 2\)</span> and <span class="math inline">\(X2=4\)</span>?)</p>
<ul>
<li>In OLS, this would be <span class="math inline">\(\hat Y_i = \hat \alpha + 2*\hat \beta_1 + 4*\hat \beta_2\)</span></li>
</ul>
<p>Here, we can do the same for GLMs by setting specific values for <span class="math inline">\(X\)</span> when we apply the <span class="math inline">\(Link^{-1}\)</span> response function.</p>
<ul>
<li>E.g., What is the predicted probability of <span class="math inline">\(Y_i = 1\)</span> when <span class="math inline">\(X1 = 2\)</span> and <span class="math inline">\(X2=4\)</span>?
<ul>
<li>In logistic regression, <span class="math inline">\(\hat{\pi_i} = \frac{\exp(\hat \alpha + 2*\hat \beta_1 + 4*\hat \beta_2)}{1 + \exp(\hat \alpha + 2*\hat \beta_1 + 4*\hat \beta_2)}\)</span></li>
</ul></li>
</ul>
<p><strong>Example 1</strong></p>
<p>Example using the Conflict data using different approaches in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Predicted probability when Allies = 1, and all other covariates = 0</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>allies1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(out.logit, <span class="at">newdata =</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">data.frame</span>( <span class="at">MajorPower =</span> <span class="dv">0</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Contiguity =</span> <span class="dv">0</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Allies =</span> <span class="dv">1</span>, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ForeignPolicy =</span> <span class="dv">0</span>,<span class="at">BalanceOfPower =</span> <span class="dv">0</span>, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">YearsSince =</span> <span class="dv">0</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>allies1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1 
0.002632504 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## for allies = 1, careful of the order to make same as coefficients</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span> , <span class="dv">0</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(out.logit)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Approach 1</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plogis</span>(X <span class="sc">%*%</span> bh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]
[1,] 0.002632504</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Approach 2</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(X<span class="sc">%*%</span> bh)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(X<span class="sc">%*%</span> Bh))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]
[1,] 0.002632504</code></pre>
</div>
</div>
<p><strong>Example 2</strong></p>
<p>Second example keeping X at observed values. Here the manual approach is easier given the limitations of <code>predict</code> (at least until we learn a new package). Now we are estimating <span class="math inline">\(N\)</span> predicted probabilities, so we take the mean to get the average estimate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## for allies = 1careful of the order to make same as coefficients</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>X[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># change Allies to 1, leave everything else as is</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(out.logit)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Approach 1</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">plogis</span>(X <span class="sc">%*%</span> bh))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002759902</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Approach 2</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">exp</span>(X<span class="sc">%*%</span> bh)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(X<span class="sc">%*%</span> Bh)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002759902</code></pre>
</div>
</div>
<p>This is the average predicted probability of having a dispute when the dyad states are Allies, holding other covariates at their observed values.</p>
<p>Here is a brief video with a second example of the process above, leading into the discussion of marginal effects below. It uses the <a href="https://raw.githubusercontent.com/ktmccabe/teachingdata/main/anesdems.csv">anes data</a> from Banda and Cassese in section 6.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/vGt-OCJoCJQ" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<section id="marginal-effects" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="marginal-effects"><span class="header-section-number">7.2.1</span> Marginal Effects</h3>
<p>Recall, in linear regression a one-unit change in <span class="math inline">\(X_k\)</span> is associated with a <span class="math inline">\(\hat \beta_k\)</span> change in <span class="math inline">\(Y\)</span> no matter where we are in the domain of <span class="math inline">\(X_k\)</span>. (The slope of a line is constant!)</p>
<p>The catch for glm’s, again, is that our linear predictor (<span class="math inline">\(\eta\)</span>) is often not in the units of <span class="math inline">\(Y\)</span> that we want. E.g., In logistic regression, a one-unit change in <span class="math inline">\(X_k\)</span> is associated with a <span class="math inline">\(\hat \beta_k\)</span> logits change</p>
<ul>
<li>Recall, for logit and probit, this takes us into an S-curve for <span class="math inline">\(Pr(Y_i = 1)\)</span> instead of a line</li>
<li>Well, the slope of an S-curve is not constant. Depending on where we are in <span class="math inline">\(X\)</span>, it will influence how much change we have in the predicted probability of <span class="math inline">\(Y_i = 1\)</span>.</li>
<li>Therefore, to understand the marginal effect in glm’s we have to set <span class="math inline">\(X\)</span> to particular values and be careful about the values we select.
<ul>
<li>By “careful,” this means choosing sensible, theoretically informed values of interest.</li>
</ul></li>
</ul>
<p>You can generate predictions based on any values. Here are three common approaches for understanding the marginal effect of a particular variable <span class="math inline">\(X_k\)</span>.</p>
<ul>
<li>Marginal effects at the mean</li>
<li>Average marginal effects</li>
<li>Marginal effects at representative values</li>
</ul>
<p>Wait, what do we mean by marginal effects?</p>
<ul>
<li>For a discrete (categorical/factor) variable (<span class="math inline">\(X_k\)</span>) this will be the change in predicted probability associated with a one-unit change in (<span class="math inline">\(X_k\)</span>).</li>
<li>For continuous variables (<span class="math inline">\(X_k\)</span>), this technically is the instantaneous rate of change (change in probability associated with a very small change in <span class="math inline">\(X\)</span>).
<ul>
<li>Usually instead of estimating this (what is a very small change anyway?) we will do this by hand instead, and set the specific amount of change). Often, this is called “discrete change” or “first difference” effect.</li>
</ul></li>
</ul>
</section>
<section id="marginal-effects-at-the-mean" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="marginal-effects-at-the-mean"><span class="header-section-number">7.2.2</span> Marginal effects at the mean</h3>
<p>In this approach, when we calculate the difference in predicted probability resulting from a one-unit change in <span class="math inline">\(X_k\)</span>, we set all other covariates <span class="math inline">\(X_j\)</span> for <span class="math inline">\(j \neq k\)</span> at their <strong><em>mean values</em></strong>.</p>
<ul>
<li>This gives us 1 estimate for the difference in predicted probability</li>
<li>When can this be problematic? (think categorical variables)</li>
</ul>
</section>
<section id="marginal-effects-at-representative-values" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="marginal-effects-at-representative-values"><span class="header-section-number">7.2.3</span> Marginal effects at representative values</h3>
<p>In this approach, when we calculate the difference in predicted probability resulting from a one-unit change in <span class="math inline">\(X_k\)</span>, we set all other covariates <span class="math inline">\(X_j\)</span> for <span class="math inline">\(j \neq k\)</span> at values that are of theoretical interest. This could be the mean value, modal vale, or some other value that makes sense for our research question.</p>
<ul>
<li>This gives us 1 estimate for the difference in predicted probability</li>
<li>Depending on your research question, there may/may not be a particularly interesting set of representative values on all of your covariates.</li>
</ul>
<p>The example above where we held all other covariates at zero would be an example of calculating marginal effects at representative values.</p>
</section>
<section id="average-marginal-effects" class="level3" data-number="7.2.4">
<h3 data-number="7.2.4" class="anchored" data-anchor-id="average-marginal-effects"><span class="header-section-number">7.2.4</span> Average marginal effects</h3>
<p>In this approach, when we calculate the difference in predicted probability resulting from a one-unit change in <span class="math inline">\(X_{ik}\)</span>, we hold all covariates <span class="math inline">\(X_{ij}\)</span> for <span class="math inline">\(j \neq k\)</span> at their <strong><em>observed values</em></strong>.</p>
<ul>
<li>This gives us <span class="math inline">\(N\)</span> estimates for the difference in predicted probability</li>
<li>We report the average of these estimates</li>
</ul>
<p>Here is an example for average marginal effects. Let’s sat we were interested in the difference in probability of a dispute for Allies vs.&nbsp;non-Allies, when all other covariates are zero. We can do this manually or in <code>predict</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract beta coefficients</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(out.logit)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Set Allies to 1, hold all other covariates as observed</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>X1[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Set Allies to 0, hold all other covariates as observed</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>X0[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>pp1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(X1 <span class="sc">%*%</span> Bh))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>pp0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(X0 <span class="sc">%*%</span> Bh))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>pp1 <span class="sc">-</span> pp0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.0009506303</code></pre>
</div>
</div>
<p>This represents the average difference in predicted probability of having a dispute for Dyads that are Allies vs.&nbsp;not Allies.</p>
</section>
<section id="marginaleffects-prediction-and-margins-packages." class="level3" data-number="7.2.5">
<h3 data-number="7.2.5" class="anchored" data-anchor-id="marginaleffects-prediction-and-margins-packages."><span class="header-section-number">7.2.5</span> <code>marginaleffects</code>, <code>prediction</code> and <code>margins</code> packages.</h3>
<p>There are functions that can make this easier so long as you understand what they are doing.</p>
<p>One package developed by Dr.&nbsp;Thomas Leeper is <code>prediction</code>. A second is <code>margins</code>. Documentation available <a href="https://github.com/leeper/prediction">here</a> and <a href="https://github.com/leeper/margins">here</a>. More recently, Vincent Arel-Bundock has developed the <code>marginaleffects</code> package, which has more expansive functionality <a href="https://marginaleffects.com/">here</a>.</p>
<p>It is always important to understand what’s going on in a package because, for one, it’s possible that the package will stop being updated, and you will have to find an alternative solution.</p>
<section id="marginaleffects" class="level4" data-number="7.2.5.1">
<h4 data-number="7.2.5.1" class="anchored" data-anchor-id="marginaleffects"><span class="header-section-number">7.2.5.1</span> <code>marginaleffects</code></h4>
<p>We first look at the <code>marginaleffects</code> package. The <code>predictions</code> function generates specific quantities of interest. An advantage it has over the built-in <code>predict</code> function is that it makes it easier to “hold all other variables at observed values.” In the <code>predictions</code> function, you specify the designated values for particular variables, and then by default, it assumes you want to hold all other variables at observed values. Here is an example of generating predicted probabilities for <code>Allies = 1</code> and <code>Allies = 0</code>. It will generate the summary means of these two predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>preout <span class="ot">&lt;-</span> <span class="fu">predictions</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    out.logit,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"Allies"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">datagridcf</span>(<span class="at">Allies =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>datagridcf</code> argument stands for a counterfactual dataset, where we are keeping the data as they are observed, but counterfactually changing <code>Allies</code> from 0 to 1. By putting <code>type="response"</code>, we make sure our results are in terms of predicted probabilities.</p>
<p>We can then conduct comparisons using the <code>comparison</code> or <code>avg_comparisons</code> functions, looking at, for example, the average difference in predicted probability, going from Allies being 0 to 1, keeping all covariates at their observed values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">comparisons</span>(out.logit,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">Allies =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(comp<span class="sc">$</span>estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.0009506303</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>comp_avg <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(out.logit,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">Allies =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>comp_avg<span class="sc">$</span>estimate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.0009506303</code></pre>
</div>
</div>
</section>
<section id="prediction" class="level4" data-number="7.2.5.2">
<h4 data-number="7.2.5.2" class="anchored" data-anchor-id="prediction"><span class="header-section-number">7.2.5.2</span> <code>prediction</code></h4>
<p>Here we will focus on the <code>prediction</code> package. The <code>prediction</code> function generates specific quantities of interest. An advantage it has over the built-in <code>predict</code> function is that it makes it easier to “hold all other variables at observed values.” In the <code>prediction</code> function, you specify the designated values for particular variables, and then by default, it assumes you want to hold all other variables at observed values. Here is an example of generating predicted probabilities for <code>Allies = 1</code> and <code>Allies = 0</code>. It will generate the summary means of these two predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages("prediction")</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prediction)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="do">## By default, allows covariates to stay at observed values unless specified</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">prediction</span>(out.logit, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">Allies =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)), </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Data frame with 200000 predictions from
 glm(formula = Conflict ~ MajorPower + Contiguity + Allies + ForeignPolicy + 
    BalanceOfPower + YearsSince, family = binomial(link = "logit"), 
    data = mids)
with average predictions:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Allies        x
      0 0.003711
      1 0.002760</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## compare with the manual calculated values above</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>pp0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.003710532</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pp1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002759902</code></pre>
</div>
</div>
</section>
</section>
<section id="qoi-practice-problems" class="level3" data-number="7.2.6">
<h3 data-number="7.2.6" class="anchored" data-anchor-id="qoi-practice-problems"><span class="header-section-number">7.2.6</span> QOI Practice Problems</h3>
<ol type="1">
<li>Conduct the following regression using <code>glm</code></li>
</ol>
<p><span class="math inline">\(Pr(Conflict_i = 1 | X) = logit^{-1}(\alpha + \beta_1 * Allies_i + \beta_2 * MajorPower_i + \beta_3 * ForeignPolicy_i)\)</span></p>
<ol start="2" type="1">
<li><p>What is the predicted probability of entering a dispute when the dyad includes a major power, holding all covariates at observed values?</p></li>
<li><p>Repeat the previous exercise, but now use probit. How similar/different are the predicted probability estimates?</p></li>
</ol>
<details>
<summary>
Try on your own, then expand for the solution.
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Problem 1</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>out.logit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Conflict <span class="sc">~</span> Allies <span class="sc">+</span> MajorPower <span class="sc">+</span> ForeignPolicy, <span class="at">data=</span>mids,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Problem 2</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prediction)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">prediction</span>(out.logit, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">MajorPower =</span> <span class="dv">1</span>), </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Data frame with 100000 predictions from
 glm(formula = Conflict ~ MajorPower + Contiguity + Allies + ForeignPolicy + 
    BalanceOfPower + YearsSince, family = binomial(link = "logit"), 
    data = mids)
with average prediction:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> MajorPower        x
          1 0.007745</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Problem 3</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>out.probit <span class="ot">&lt;-</span> <span class="fu">glm</span>(Conflict <span class="sc">~</span> Allies <span class="sc">+</span> MajorPower <span class="sc">+</span> ForeignPolicy, <span class="at">data=</span>mids,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"probit"</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">prediction</span>(out.probit, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">MajorPower =</span> <span class="dv">1</span>), </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Data frame with 100000 predictions from
 glm(formula = Conflict ~ Allies + MajorPower + ForeignPolicy, 
    family = binomial(link = "probit"), data = mids)
with average prediction:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> MajorPower       x
          1 0.01451</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Manual approach</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.probit)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>X[, <span class="st">"MajorPower"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>Bhat <span class="ot">&lt;-</span> <span class="fu">coef</span>(out.probit)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">pnorm</span>(X <span class="sc">%*%</span> Bhat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01450613</code></pre>
</div>
</div>
</details>
</section>
</section>
<section id="uncertainty" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="uncertainty"><span class="header-section-number">7.3</span> Uncertainty</h2>
<p>Usually, we want to report a confidence interval around our predicted probabilities, average predicted probabilities, or around the difference in our predicted probabilities or difference in our average predicted probabilities.</p>
<p>This is different from the uncertainty of a coefficient, which we already have from our <code>glm</code> output. Here, if we say there is a 0.01 probability of a dispute, that is just an estimate, it is going to vary over repeated samples. We want to generate a confidence interval that represents this variability in <span class="math inline">\(\hat \pi\)</span>.</p>
<p>We have already discussed using the <code>predict</code> function in <code>lm</code> to generate confidence intervals for OLS estimates. In a limited set of cases, we can also use this shortcut for <code>glm</code> by taking advantage of the distribution being approximately normal on the scale of the linear predictor. When we are estimating confidence intervals around 1) one or multiple single quantities of interest (a predicted probability, as opposed to a difference in predicted probability) 2) where the <span class="math inline">\(X\)</span> values are set at specific values (and not at their observed values) then, we can plug this into the <code>predict</code> function in the following way:</p>
<ol type="1">
<li>Generate the prediction and standard errors of the prediction on the <code>link</code> linear predictor scale.
<ul>
<li>On the scale of the linear predictor, the standard errors of the prediction are calculated as <span class="math inline">\(\sqrt{\mathbb{x'}_c \text{vcov(fit)} \mathbb{x}_c}\)</span> using the delta method.</li>
</ul></li>
<li>Calculate the CI on the linear predictor scale: <span class="math inline">\(CI(\hat \theta) = \hat \theta - z_{crit}*se_{\hat \theta}\)</span> ; <span class="math inline">\(\hat \theta + z_{crit}*se_{\hat \theta}\)</span>
<ul>
<li><span class="math inline">\(z_{crit}\)</span> for the 95% confidence interval is 1.96 (so this is saying +/- about 2 standard errors). We get this by using <code>qnorm()</code>.</li>
</ul></li>
<li>Convert the prediction and confidence intervals to the response scale.</li>
</ol>
<p>Here is an example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Predicted probability when Allies = 1 and all other covariates = 0</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Note type = "link"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>allies1.link <span class="ot">&lt;-</span> <span class="fu">predict</span>(out.logit, <span class="at">newdata =</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">data.frame</span>( <span class="at">MajorPower =</span> <span class="dv">0</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Contiguity =</span> <span class="dv">0</span>, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Allies =</span> <span class="dv">1</span>, </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">ForeignPolicy =</span> <span class="dv">0</span>,<span class="at">BalanceOfPower =</span> <span class="dv">0</span>, </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">YearsSince =</span> <span class="dv">0</span>),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"link"</span>, <span class="at">se =</span> T)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>allies1 <span class="ot">&lt;-</span>  <span class="fu">plogis</span>(allies1.link<span class="sc">$</span>fit)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>allies1.lb <span class="ot">&lt;-</span> <span class="fu">plogis</span>(allies1.link<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>allies1.link<span class="sc">$</span>se.fit)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>allies1.ub <span class="ot">&lt;-</span> <span class="fu">plogis</span>(allies1.link<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>allies1.link<span class="sc">$</span>se.fit)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Confidence interval</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(allies1, allies1.lb, allies1.ub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          1           1           1 
0.002632504 0.001302711 0.005312514 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## By hand (using x as a k x 1 vector)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>x.c <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>se.hand <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(x.c) <span class="sc">%*%</span> <span class="fu">vcov</span>(out.logit) <span class="sc">%*%</span> x.c)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>p.hand <span class="ot">&lt;-</span> <span class="fu">t</span>(x.c) <span class="sc">%*%</span> <span class="fu">coef</span>(out.logit)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>allies1.hand <span class="ot">&lt;-</span> <span class="fu">plogis</span>(p.hand)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>allies1.hand.lb <span class="ot">&lt;-</span> <span class="fu">plogis</span>(p.hand<span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>se.hand)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>allies1.hand.ub <span class="ot">&lt;-</span> <span class="fu">plogis</span>(p.hand <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>se.hand)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(allies1.hand, allies1.hand.lb, allies1.hand.ub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002632504 0.001302711 0.005312514</code></pre>
</div>
</div>
<p>Beyond this simple case, there are three general approaches to calculating the uncertainty of the quantities of interest. Here is a video with an overview of these three processes. The course notes contain additional detail below. It continues with the <a href="https://raw.githubusercontent.com/ktmccabe/teachingdata/main/anesdems.csv">anes data</a> example from Banda and Cassese in section 6, as did the other video in this section.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/BYE4TWV6Byc" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<ul>
<li>Delta Method (based on calculus, first order Taylor Expansion approximation)</li>
<li>Bootstrapping (very flexible, common, computationally demanding)</li>
<li>Quasi-bayesian (flexible, less computationally demanding), also described as simulation/Monte carlo simulation.</li>
</ul>
<p>For now, we will focus on the second two methods, but some statistical software programs will report uncertainty estimates based on the Delta method. Here is more information on this <a href="https://stats.idre.ucla.edu/r/faq/how-can-i-estimate-the-standard-error-of-transformed-regression-parameters-in-r-using-the-delta-method/">method</a> and the <code>deltamethod</code> <a href="https://www.r-bloggers.com/2018/01/delta-method-standard-errors/">function</a> in R.</p>
<section id="bootstrapping" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="bootstrapping"><span class="header-section-number">7.3.1</span> Bootstrapping</h3>
<p>Bootstrapping simulates the idea of conducting repeated samples to generate a distribution of estimates of your quantity of interests. We “resample” from our existing data to generate thousands of new datasets, and use each dataset to generate a slightly different quantity of interest. This distribution is then used to construct the confidence interval.</p>
<p>Process:</p>
<ul>
<li>Sample from the data to generate new data frame</li>
<li>Run the model: this gives new coefficient estimates and new covariate matrices</li>
<li>Use new coefficient and covariate estimates to compute quantity of interest</li>
<li>Replicate the previous process for about 1000 iterations to get 1000 estimates of quantity of interest</li>
<li>Use the distribution of these estimates to calculate confidence intervals</li>
</ul>
<p>Why? How does this work?</p>
<ul>
<li>It is simulating the exercise of hypothetical repeated samples</li>
<li>Similar to Law of Large Numbers- with sufficient iterations, the empirical “bootstrap” distribution is a good approximation of the true distribution (will get closer and closer to the truth)
<ul>
<li>It won’t help us correct a bad estimate– have to work from the data we have.</li>
</ul></li>
<li>The logic is we think the distribution of <span class="math inline">\(\bar x\)</span> sample estimate is centered on <span class="math inline">\(\mu\)</span> (the truth), and then we assume the distribution of <span class="math inline">\(\bar x*\)</span> (the bootstrapped estimate) is centered on <span class="math inline">\(\bar x\)</span></li>
</ul>
<p>This would be a good place to review the Bootstrap resources at the front of the section:</p>
<ul>
<li>Pezullo, John. <a href="https://www.dummies.com/education/science/biology/the-bootstrap-method-for-standard-errors-and-confidence-intervals/">The Bootstrap Method for Standard Errors and Confidence Intervals.</a></li>
<li>Banks, David. <a href="http://www2.stat.duke.edu/~banks/111-lectures.dir/lect13.pdf">Lecture from Duke University.</a></li>
</ul>
<p>How do we implement this procedure?</p>
<p><strong><em>Example</em></strong></p>
<p>Find the point estimate and 95% CI for the average predicted probability of conflict when the dyad are allies and all other covariates are held at observed values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Original regression</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>out.logit <span class="ot">&lt;-</span><span class="fu">glm</span>(Conflict <span class="sc">~</span>  MajorPower <span class="sc">+</span> Contiguity <span class="sc">+</span> Allies <span class="sc">+</span> ForeignPolicy <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    BalanceOfPower <span class="sc">+</span> YearsSince, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> mids)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="do">## We need to build our bootstrap procedure</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's assume we just want 1 iteration</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 1: sample to generate new data</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="do">## this selects N row numbers from mids, with replacement</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>wrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mids), <span class="at">size =</span> <span class="fu">nrow</span>(mids), <span class="at">replace =</span> T)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Create subset of data based on these rows</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> mids[wrows, ]</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: run your regression model with the new data</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>boot.logit <span class="ot">&lt;-</span><span class="fu">glm</span>(Conflict <span class="sc">~</span>  MajorPower <span class="sc">+</span> Contiguity <span class="sc">+</span> Allies <span class="sc">+</span> ForeignPolicy <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    BalanceOfPower <span class="sc">+</span> YearsSince, </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> subdata)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: generate average predicted probability</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>Xboot <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(boot.logit)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>Xboot[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot.logit)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>p.boot <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(Xboot <span class="sc">%*%</span> Bh))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Expand below for more details on what the sample function does.
</summary>
<p>Let’s say we have a dataframe of different colors and shapes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>somedata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"yellow"</span>, <span class="st">"green"</span>, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"black"</span>),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">shapes =</span> <span class="fu">c</span>(<span class="st">"circle"</span>, <span class="st">"square"</span>, <span class="st">"triangle"</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"rectangle"</span>, <span class="st">"diamond"</span>, <span class="st">"line"</span>, <span class="st">"sphere"</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>somedata                                  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  colors    shapes
1    red    circle
2   blue    square
3 yellow  triangle
4  green rectangle
5 purple   diamond
6 orange      line
7  black    sphere</code></pre>
</div>
</div>
<p>I could generate a new “resampled” dataset with the <code>sample</code> function. We tell the function three things: 1) choose from the row numbers in my dataframe (<code>1:nrow(somedata)</code>), 2) pick <span class="math inline">\(N\)</span> row numbers in total (<code>nrow(somedata)</code>), 3) Each time you pick a given row number <span class="math inline">\(i\)</span>, put it back in the data, allowing the possibility that you may randomly sample it again (<code>replace = TRUE</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(somedata), <span class="fu">nrow</span>(somedata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 1 6 3 2 5 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(somedata), <span class="fu">nrow</span>(somedata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 4 6 2 1 2 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(somedata), <span class="fu">nrow</span>(somedata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 4 7 6 2 2 5</code></pre>
</div>
</div>
<p>What happened is the function generated a set of row numbers. Note how it is possible for the same row number to be picked multiple times. Each time we run the sample function, we get slightly different row numbers.</p>
<p>We can subset our data based on these row indices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">## store row indices</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>wrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(somedata), <span class="fu">nrow</span>(somedata), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>wrows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4 5 4 7 7 2 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## subset data to include rows sampled</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="do">## note if row indices are in wrows more than once, they will also be in the subset more than once</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> somedata[wrows,]</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>subdata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    colors    shapes
4    green rectangle
5   purple   diamond
4.1  green rectangle
7    black    sphere
7.1  black    sphere
2     blue    square
6   orange      line</code></pre>
</div>
</div>
<p>Given that each time the sample function runs, we get slightly different random samples of the data, that’s how we end up with a distribution of slightly different estimates of our quantities of interest. Each time the regression is run with a slightly different dataset.</p>
</details>
<p>This gives us one estimate of the average predicted probability stored in <code>p.boot</code>. However, the idea of a bootstrap is that we repeat this procedure at least 1000 times to generate a distribution of estimates of the quantity of interest, the average predicted probability in this case.</p>
<p>We could literally repeat that code chunk 1000 times…. but, we have better things to do than that much copy/paste. Instead, we will create a function that will do this automatically.</p>
<p>To do so, we are going to wrap our procedure above inside the syntax for creating functions in R. In R, to create a function,</p>
<ul>
<li>We first name the function. (Let’s call this <code>myboot</code>. You could call yours anything.)</li>
<li>The next syntax is always <code>myboot &lt;- function(){}</code>.</li>
<li>Inside the <code>function()</code> part, you tell R what you are going to supply the function each time you want it to run. Sometimes functions only have one input, others like <code>lm</code> have multiple inputs.
<ul>
<li>For example, in the function <code>mean(x)</code>, we always supply that function with a vector of values.</li>
<li>For this bootstrap example, we are going to write the function as one where we will supply the function with a dataframe. Let’s call this <code>df</code>.</li>
</ul></li>
<li>The inside part of the function, between the <code>{}</code> is the procedure from above. All we do is
<ul>
<li>Instead of writing <code>mids</code>, we keep it generic by writing <code>df</code>.</li>
<li>We add a final line that tells R what we want it to <code>return()</code> as the output of the function. Here, we want it to return the average predicted probability.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="do">## We need to build our bootstrap function</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: Let's wrap our current steps into a function that we can replicate</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Note: all we need as an input is our data.frame mids</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="do">## I will label it something generic to show how a function can work</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>myboot <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  wrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), <span class="at">size =</span> <span class="fu">nrow</span>(df), <span class="at">replace =</span> T)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Create subset of data based on these rows</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> df[wrows, ]</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Step 2: run your regression model with the new data</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  boot.logit <span class="ot">&lt;-</span><span class="fu">glm</span>(Conflict <span class="sc">~</span>  MajorPower <span class="sc">+</span> Contiguity <span class="sc">+</span> Allies <span class="sc">+</span> ForeignPolicy <span class="sc">+</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    BalanceOfPower <span class="sc">+</span> YearsSince, </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> subdata)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Step 3: generate average predicted probability</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  Xboot <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(boot.logit)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  Xboot[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot.logit)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  p.boot <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(Xboot <span class="sc">%*%</span> Bh))</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p.boot)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: here, our quantity of interest is the predicted probability of a dispute when the dyad are Allies. Let’s say, instead, we wanted the difference in predicted probability of a dispute between Allies and Non-Allies. Well, we would just adjust our function to calculate the mean probabilities for Allies and Non-Allies and return the difference in these means as the quantity of interest. We would then get 10000 estimates of this <strong><em>difference</em></strong> in probabilties.</p>
<p>Now that we have the function from above, instead of copying/pasting this 1000 times, we will use the function called <code>replicate</code> which will do this for us. We indicate the number of estimates we want and then indicate which function (and in our case, which dataframe inside the function) we want to replicate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="do">## This may take a minute to run. </span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="do">## We will do just 50, Normally you will want this to be more like 1000</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># this helps us get the same results each time, good for reproducibility</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>myestimates <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">50</span>, <span class="fu">myboot</span>(mids))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The bootstrapping approach is very computationally demanding given it has to repeat an operation several (thousand) times. After you hit “run,” just sit back, relax and wait for the <a href="https://www.youtube.com/watch?v=9N9opF-PK5k">water to run dry.</a></p>
<details>
<summary>
For a troubleshooting tip, expand.
</summary>
<p>If you get an error message at the <code>replicate(1000, myboot(mids))</code> stage, it is best to see if your function runs at all. Try just the below to see if it generates output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">myboot</span>(mids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002250429</code></pre>
</div>
</div>
<p>If you get the error here, then it means there is a bug within the function code, not the replicate code.</p>
</details>
<p>Each time we replicate the function, it will generate slightly different results because the <code>sample</code> functions is randoming sampling rows of data each time. We can plot the distribution of estimates to show this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> myestimates), <span class="fu">aes</span>(<span class="at">x =</span> myestimates)) <span class="sc">+</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The final step after generating the bootstrap distribution of estimates is to use it to construct a confidence interval for the quantity of interest. There are a few ways to do this.</p>
<ul>
<li>Normal approximation</li>
<li>Percentile</li>
<li>Bias correction</li>
</ul>
<p>In each approach, we take our original “point estimate” from the computation of the quantity of interest from our original data and use the bootstrap estimates for the lower and upper bounds of the confidence interval. Here we will assume we want a 95% confidence interval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the original point estimate</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(out.logit)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>X1[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>pe1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(X1 <span class="sc">%*%</span> Bh))</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Normal</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>((pe1 <span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">var</span>(myestimates))),(pe1 <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">var</span>(myestimates))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002174802 0.003345002</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Percentile</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(myestimates, <span class="fu">c</span>(<span class="fl">0.025</span>, .<span class="dv">975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       2.5%       97.5% 
0.002275356 0.003431285 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Bias correction</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>bc <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>pe1 <span class="sc">-</span> myestimates</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(bc, <span class="fu">c</span>(<span class="fl">0.025</span>, .<span class="dv">975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       2.5%       97.5% 
0.002088520 0.003244449 </code></pre>
</div>
</div>
<p>Each of these is pretty commonly used, but they may generate slightly different results.</p>
</section>
<section id="simulated-confidence-intervals" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="simulated-confidence-intervals"><span class="header-section-number">7.3.2</span> Simulated Confidence Intervals</h3>
<p>Quasi-Bayesian or simulated confidence intervals take advantage of the large sample properties of our estimates <span class="math inline">\(\hat \beta\)</span> having a Normal sampling distribution due to the Central Limit Theorem.</p>
<p>Like the bootstrap, the simulation procedure also generates hypothetical new samples. However, here, we are sampling new <span class="math inline">\(\hat \beta\)</span> estimates each time instead of sampling a new underlying dataset each time. This allows use to skip the step of generating a new dataset and running the regression 1000 times. Here, we just run the regression model once. The simulation process takes place after this step.</p>
<p>Process</p>
<ul>
<li>Estimate your model (e.g., with <code>optim</code> or <code>glm</code>)</li>
<li>Sample <span class="math inline">\(\sim\)</span> 1000 new estimates of the vector of <span class="math inline">\(\hat \beta\)</span> by using the <code>vcov</code> of <span class="math inline">\(\hat \beta\)</span> to generate the uncertainty</li>
<li>For each of these new <span class="math inline">\(\hat \beta_c\)</span>, calculate <span class="math inline">\(\hat \theta_c\)</span>, in this case, the predicted probabilities.</li>
<li>Estimate “fundamental uncertainty” by drawing new y’s based on these parameters
<ul>
<li>Only necessary in some cases. Depends on Jensen’s Inequality discussed in the Gary King resources and in the details on the use of <code>rbinom</code> function below.</li>
<li>We are going to average over this, which means we are calculating “expected values.”</li>
</ul></li>
<li>Use this distribution to compute the CI’s</li>
</ul>
<p>This would be a good place to review the resources from Gary King:</p>
<ul>
<li>Overview of simulation approach for calculating uncertainty from <a href="https://gking.harvard.edu/files/abs/making-abs.shtml">King, Tomz, and Wittenberg 2000</a>.</li>
<li>Lecture video from Gary King on <a href="https://www.youtube.com/watch?v=gbokhfMdfE8">simulating quantities of interest</a></li>
</ul>
<p><strong><em>Example</em></strong></p>
<p>The code for this approach will more simple in a case where we are computing quantities of interest when covariates are held at means or representative values (cases where we get just one predicted probability associated with each set of <span class="math inline">\(X\)</span> values). It will look a little more complex in cases where we want to hold covariates at observed values and calculate the average predicted probability.</p>
<p>First, let’s find the point estimate and 95% CI for the predicted probability of conflict when the dyad are Allies, and all other covariates are held at zero.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages("mvtnorm")</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: Sample 1000 new Bhs (we will use 50 for this example)</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="do">## This uses the multivariate normal distribution for resampling</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>numsims <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>qb.beta <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(numsims, <span class="fu">coef</span>(out.logit), <span class="fu">vcov</span>(out.logit)) </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="do">## This generates numsims X k coefficients matrix</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Iterate through the estimates</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Create an empty vector to store 1000 quantities of interest</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>qestimatessimple <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, numsims)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Here, our covariate matrix stays the same each time</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="do">## We have a 1 for intercept and 1 for Allies, everything else at zero</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span> , <span class="dv">0</span>) </span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="do">## X1 is a 1 X k matrix</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Use a loop to iterate through each set of betas</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numsims){</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each set of betas, calculate p probs</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for a given set of betas, this gives us nrow(X1) predicted probabilities</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>  pestimate <span class="ot">&lt;-</span><span class="fu">plogis</span>(X1 <span class="sc">%*%</span> qb.beta[i,])</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fundamental uncertainty</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## not required for logit/probit, but we will show how</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## rbinom generates 1000 0's or 1's based on the predicted probability</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We use rbinom bc of the bernoulli, other glm's will have other distributions</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## then we take the mean to get our estimate of the predicted probability</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>  moutcome <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">rbinom</span>(numsims, <span class="dv">1</span>, pestimate))</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>  qestimatessimple[i] <span class="ot">&lt;-</span>moutcome</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">## repeat for set of simulated betas</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: Similar to bootstrap distribution, find CI using the percentiles</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(qestimatessimple, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 2.5% 97.5% 
 0.00  0.02 </code></pre>
</div>
</div>
<p>For more information on loops in R, you can follow this <a href="https://drive.google.com/file/d/18sX5B5bXum0WPC5sRhQIHtJAwEh76VIn/view?usp=sharing">tutorial</a> we created for 2020 SICSS-Rutgers.</p>
<details>
<summary>
Expand for details on rbinom.
</summary>
<p><code>rbinom</code> is the random generation function for the binomial distribution. If we supply it with number of trials (in the Bernoulli, this is 1), and a probability of success, it will generate our desired number of outcomes according to this distribution.</p>
<p>For example, let’s say we wanted to generate a random set of 100 coin flips for a coin that is fair– where the probability of success is .5. We will get a sample of 0’s and 1’s. If we take the mean, it will be close to .5, and with enough coin flips, will converge on .5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>rb.res <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, .<span class="dv">5</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>rb.res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 0 1 0 0 0 0 1 0 0 0 1 0 1 1 0 1 0 1 0 0 1 0 1 0 1 1 0 1 0 1 0 1 1 1 1 0 0
 [38] 0 0 0 0 1 1 1 1 0 1 0 1 0 1 1 0 1 1 0 0 0 0 0 0 1 1 0 0 1 0 1 0 0 0 0 1 1
 [75] 1 1 1 1 0 0 1 0 1 0 0 1 0 1 1 0 1 1 1 1 1 1 0 1 0 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(rb.res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.49</code></pre>
</div>
</div>
<p>In logit/probit, this step is unneccessary because the <span class="math inline">\(\mathbb{E}(y_i) = \pi_i\)</span>. When we take the mean of our <code>rbinom</code> estimates, we are just going to recover the probability we supplied to it.</p>
<p>However, in other cases, Jensen’s inequality may apply, which states that <span class="math inline">\(\mathbb{E}[g(X)] \neq g(\mathbb{E}[X])\)</span>. For example, if we have an outcome that is distributed according to the exponential distribution: Here, the <span class="math inline">\(\theta\)</span> is <span class="math inline">\(\lambda\)</span> where <span class="math inline">\(\lambda = \frac{1}{e^{X\beta}}\)</span> but <span class="math inline">\(\mathbb{E}(y)= \frac{1}{\lambda}\)</span>. Unfortunately, <span class="math inline">\(\mathbb{E}(\frac{1}{\hat \lambda}) \neq \frac{1}{\mathbb{E}(\hat \lambda)} = \frac{1}{\mathbb{E}(e^{X\beta})}\)</span>. For that example, the <code>rexp()</code> step in this case would be essential.</p>
<p>If we’re not sure when Jensen’s inequality will apply, we can just keep the fundamental uncertainty step as part of the process.</p>
</details>
<p>Find the point estimate and 95% CI for the average predicted probability of conflict when the dyad are allies and all other covariates are held at observed values. Here, the code is more complicated, because every time we generate a predicted probability (for any observed value), we need to go through the fundamental uncertainty step (when applicable).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages("mvtnorm")</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: Sample 1000 new Bhs (we will use 50 for this example)</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="do">## This uses the multivariate normal distribution for resampling</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>numsims <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>qb.beta <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(numsims, <span class="fu">coef</span>(out.logit), <span class="fu">vcov</span>(out.logit)) </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="do">## This generates numsims X k coefficients matrix</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Iterate through the estimates</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Create an empty vector to store 1000 quantities of interest</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>qestimates <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, numsims)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Here, our covariate matrix stays the same</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>X1[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Use a loop to </span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numsims){</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each set of betas, calculate p probs</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for a given set of betas, this gives us nrow(X1) predicted probabilities</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>  pestimates <span class="ot">&lt;-</span><span class="fu">plogis</span>(X1 <span class="sc">%*%</span> qb.beta[i,])</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fundamental uncertainty</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## not required for logit/probit, but we will show how</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## generate empty vector for outcomes</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>  moutcomes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, numsims)</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for each probability estimate, calculate the mean of simulated y's</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pestimates)){</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    <span class="do">## rbinom generates 1000 0's or 1's based on the predicted probability</span></span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="do">## We use rbinom bc of the bernoulli, other glm's will have other distributions</span></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>    <span class="do">## then we take the mean to get our estimate of the predicted probability for a given observation</span></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>    moutcomes[j] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">rbinom</span>(numsims, <span class="dv">1</span>, pestimates[j]))</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">## take the mean of the predicted probability estimates across all observations</span></span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>  qestimates[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(moutcomes)</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>  <span class="do">## repeat for set of simulated betas</span></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: Similar to bootstrap distribution, find CI using the percentiles</span></span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(qestimates, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5%      97.5% 
0.00232977 0.00344796 </code></pre>
</div>
</div>
<p>Because the shortcut applies where we do not need to calculate fundamental uncertainty in the logit / probit case, we can simplify this to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages("mvtnorm")</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: Sample 1000 new Bhs (we will use 50 for this example)</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="do">## This uses the multivariate normal distribution for resampling</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>numsims <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>qb.beta <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(numsims, <span class="fu">coef</span>(out.logit), <span class="fu">vcov</span>(out.logit)) </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="do">## This generates numsims X k coefficients matrix</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: Iterate through the estimates</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Create an empty vector to store 1000 quantities of interest</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>qestimates <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, numsims)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Here, our covariate matrix stays the same</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out.logit)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>X1[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numsims){</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  pestimates <span class="ot">&lt;-</span><span class="fu">plogis</span>(X1 <span class="sc">%*%</span> qb.beta[i,])</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>  qestimates[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(pestimates)</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: Similar to bootstrap distribution, find CI using the percentiles</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(qestimates, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       2.5%       97.5% 
0.002314344 0.003419644 </code></pre>
</div>
</div>
<p>We can also plot the distribution of estimates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> qestimates), <span class="fu">aes</span>(<span class="at">x =</span> qestimates)) <span class="sc">+</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="visualizing-results" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="visualizing-results"><span class="header-section-number">7.4</span> Visualizing Results</h2>
<p>Now that we have our point estimates of our quantities of interest and our confidence intervals, we can <a href="https://www.youtube.com/watch/XvazQUYG1kE">kick it up a notch</a> by visualizing these results.</p>
<p>Let’s plot our predicted probability when Allies = 1 with percentile Quasi-Bayesian CI’s and Bias-Corrected Bootstrap CI’s</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">y=</span> <span class="fu">c</span>(pe1, pe1),</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">004</span>),</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">1.6</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Average Predicted Probability of Dispute when Allies"</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.main =</span> .<span class="dv">7</span>, <span class="at">cex.lab =</span> .<span class="dv">7</span>, <span class="at">cex.axis =</span> .<span class="dv">7</span>,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">""</span>, </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt =</span> <span class="st">"n"</span>) <span class="co"># removes x-axis</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add lines from c(x1, x2) on the x-axis and from c(y1, y2) on the y-axis</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># note, we don't want any horizontal movement, so we keep x1 and x2 the same c(1,1)</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="fu">quantile</span>(qestimates, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))), <span class="at">lwd =</span> <span class="fl">1.5</span>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="fu">quantile</span>(bc, <span class="fu">c</span>(<span class="fl">0.025</span>, .<span class="dv">975</span>))), <span class="at">lwd =</span> <span class="fl">1.5</span>)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co"># add text a</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.001</span>), <span class="fu">c</span>(<span class="st">"Quasi-Bayesian"</span>, <span class="st">"BC Bootstrap"</span>), <span class="at">cex =</span> .<span class="dv">7</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here is the same but in <code>ggplot</code> form.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ggplot works best if you create a dataframe of the data you want to plot</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>myg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(pe1, <span class="fu">quantile</span>(qestimates, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))),</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(pe1, <span class="fu">quantile</span>(bc, <span class="fu">c</span>(<span class="fl">0.025</span>, .<span class="dv">975</span>)))))</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(myg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pp"</span>, <span class="st">"qb"</span>, <span class="st">"bc"</span>) </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>myg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           pp          qb          bc
1 0.002759902 0.002314344 0.003419644
2 0.002759902 0.002088520 0.003244449</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="do">## now provide this dataframe to ggplot</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(myg, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(myg), <span class="at">y =</span> pp))<span class="sc">+</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">data=</span>myg, <span class="fu">aes</span>(<span class="at">x =</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(myg),  </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ymin =</span> qb, <span class="at">ymax =</span> bc), </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(.<span class="dv">5</span>, <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, .<span class="dv">005</span>) <span class="sc">+</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Predicted Probability"</span>) <span class="sc">+</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Average Predicted Probability of Dispute when Allies"</span>) <span class="sc">+</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">y =</span> .<span class="dv">004</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Quasi-Bayesian"</span>, <span class="st">"BC Bootstrap"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="additional-r-shortcuts" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="additional-r-shortcuts"><span class="header-section-number">7.5</span> Additional R shortcuts</h2>
<p>There are a few R packages that help generate these quantities of interest AND estimate uncertainty. If you understand what is going on underneath the packages, then you should feel free to use them to avoid manually coding up each process.</p>
<section id="marginaleffects-1" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="marginaleffects-1"><span class="header-section-number">7.5.1</span> marginaleffects</h3>
<p>The Marginal Effects Zoo is from Vincent Arel-Bundock. It is a relatively new package <code>marginaleffects</code> that computes a variety of quantities of interest. You can install the package below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"marginaleffects"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As discussed above, we can generate specific estimates from designated values of our covariates of interest, holding all other covariates at their observed values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>preout <span class="ot">&lt;-</span> <span class="fu">predictions</span>(</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    out.logit,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"Allies"</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">datagridcf</span>(<span class="at">Allies =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then conduct comparisons using the <code>avg_comparisons</code> function, looking at, for example, the average difference in predicted probability, going from Allies being 0 to 1, keeping all covariates at their observed values. Note that the <code>avg_comparisons</code> function returns standard errors and p-values. These are calculated through the delta method by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>comp_avg <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(out.logit,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">variables =</span> <span class="fu">list</span>(<span class="at">Allies =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>comp_avg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Term Contrast  Estimate Std. Error     z Pr(&gt;|z|)   S    2.5 %   97.5 %
 Allies    1 - 0 -0.000951   0.000403 -2.36   0.0184 5.8 -0.00174 -0.00016

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
</section>
<section id="prediction-1" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2" class="anchored" data-anchor-id="prediction-1"><span class="header-section-number">7.5.2</span> Prediction</h3>
<p>This package is useful for generating confidence intervals around single quantities of interest. The package below (margins) is better for constructing confidence intervals around the difference between quantities of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prediction)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>preout <span class="ot">&lt;-</span> <span class="fu">prediction</span>(out.logit, <span class="at">at =</span> <span class="fu">list</span>(<span class="at">Allies =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)), </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">calculate_se =</span> T)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(preout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> at(Allies) Prediction        SE      z         p    lower    upper
          0   0.003711 0.0002270 16.343 4.878e-60 0.003266 0.004156
          1   0.002760 0.0003135  8.804 1.322e-18 0.002145 0.003374</code></pre>
</div>
</div>
<p>I believe <code>prediction</code> relies on the delta method for uncertainty. The others below will have options for simulations or bootstrapped standard errors.</p>
</section>
<section id="margins" class="level3" data-number="7.5.3">
<h3 data-number="7.5.3" class="anchored" data-anchor-id="margins"><span class="header-section-number">7.5.3</span> Margins</h3>
<p>Thomas Leeper developed a package called <code>margins</code> which is modeled after the Stata <code>margins</code> command. Here is some <a href="https://thomasleeper.com/margins/articles/Introduction.html">documentation</a> for this package.</p>
<p>We first fit a regression model like normal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">glm</span>(Conflict <span class="sc">~</span>  MajorPower <span class="sc">+</span> Contiguity <span class="sc">+</span> Allies <span class="sc">+</span> ForeignPolicy <span class="sc">+</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    BalanceOfPower <span class="sc">+</span> YearsSince, <span class="at">data=</span>mids, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Open the package and use the <code>margins</code> command. It is similar to <code>prediction</code> but we will specify the uncertainty with <code>vce</code> and tell it which variable we want the marginal effect, and what type of change in that variable we want to calculate the effect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages("margins")</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(margins)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Difference in Allies 0 vs. 1 holding other covariates at 0</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Using Delta Method for uncertainty</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>marg1 <span class="ot">&lt;-</span> <span class="fu">margins</span>(out, <span class="at">vce =</span> <span class="st">"delta"</span>,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">at =</span> <span class="fu">list</span>(<span class="at">MajorPower=</span><span class="dv">0</span>, <span class="at">Contiguity=</span><span class="dv">0</span>,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">ForeignPolicy=</span><span class="dv">0</span>, <span class="at">BalanceOfPower=</span><span class="dv">0</span>, <span class="at">YearsSince=</span><span class="dv">0</span>),</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">variables =</span> <span class="st">"Allies"</span>,</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">type=</span><span class="st">"response"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in check_values(data, at): A 'at' value for 'BalanceOfPower' is outside
observed data range (0.000173599997651763,1)!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(marg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> factor MajorPower Contiguity ForeignPolicy BalanceOfPower YearsSince     AME
 Allies     0.0000     0.0000        0.0000         0.0000     0.0000 -0.0010
     SE       z      p   lower   upper
 0.0004 -2.3910 0.0168 -0.0018 -0.0002</code></pre>
</div>
</div>
<p>Let’s try a second example, shifting the uncertainty estimate and the X covariates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Difference in Allies 0 vs. 1 holding MajorPower at 1, other covariates at observed values</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Using simulations for uncertainty</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>marg2 <span class="ot">&lt;-</span> <span class="fu">margins</span>(out, <span class="at">vce =</span> <span class="st">"simulation"</span>,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">at =</span> <span class="fu">list</span>(<span class="at">MajorPower =</span><span class="dv">1</span>),</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">variables =</span> <span class="st">"Allies"</span>,</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">change =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">type=</span><span class="st">"response"</span>) </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(marg2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> factor MajorPower     AME     SE       z      p   lower  upper
 Allies     1.0000 -0.0020 0.0010 -1.9576 0.0503 -0.0041 0.0000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Manual equivalent of point estimate</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>X.marg1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>X.marg1[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>X.marg1[, <span class="st">"MajorPower"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>X.marg0 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(out)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>X.marg0[, <span class="st">"Allies"</span>] <span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>X.marg0[, <span class="st">"MajorPower"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>BH <span class="ot">&lt;-</span> <span class="fu">coef</span>(out)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>ame <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">plogis</span>(X.marg1 <span class="sc">%*%</span> BH) <span class="sc">-</span> <span class="fu">plogis</span>(X.marg0 <span class="sc">%*%</span> BH))</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>ame</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.002039019</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(marg2)<span class="sc">$</span>AME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Allies 
-0.002039019 </code></pre>
</div>
</div>
</section>
<section id="using-expand.grid" class="level3" data-number="7.5.4">
<h3 data-number="7.5.4" class="anchored" data-anchor-id="using-expand.grid"><span class="header-section-number">7.5.4</span> Using <code>expand.grid</code></h3>
<p>When we use the <code>predict</code> function in R, we specify a “`newdata” dataframe to indicate for which values of <span class="math inline">\(X\)</span> we want to estimate values of the outcome. When we do this, we are actually building a dataframe, like the below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">MajorPower =</span> <span class="dv">0</span>, <span class="at">Allies=</span><span class="dv">1</span>, <span class="at">Contiguity =</span> <span class="dv">0</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MajorPower Allies Contiguity
1          0      1          0</code></pre>
</div>
</div>
<p>In cases where we want to make predictions for multiple values of a given variable, we can feed a vector into the data.frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">MajorPower =</span> <span class="dv">0</span>, <span class="at">Allies=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">Contiguity =</span> <span class="dv">0</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MajorPower Allies Contiguity
1          0      0          0
2          0      1          0</code></pre>
</div>
</div>
<p>However, this becomes more tedious when we want to estimate for combinations of different variables (e.g., <code>MajorPower</code> and <code>Allies</code> as 0 or 1). You have to tell R precisely which rows should include which values. This means indicating four separate values for each variables to get all possible combinations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">MajorPower =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>), <span class="at">Allies=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">Contiguity =</span> <span class="dv">0</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MajorPower Allies Contiguity
1          0      0          0
2          0      1          0
3          1      0          0
4          1      1          0</code></pre>
</div>
</div>
<p>What <code>expand.grid</code> does is let you more quickly indicate that you want to estimate for all possibles combinations of the values of the variables you supply. E.g.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">MajorPower =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">Allies=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">Contiguity =</span> <span class="dv">0</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  MajorPower Allies Contiguity
1          0      0          0
2          1      0          0
3          0      1          0
4          1      1          0</code></pre>
</div>
</div>
<p>This can be a useful shortcut when you need to look at combinations of variables that have many different values.</p>
</section>
</section>
<section id="quantities-of-interest-tutorial" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="quantities-of-interest-tutorial"><span class="header-section-number">7.6</span> Quantities of Interest Tutorial</h2>
<p>Let’s return to the example at the end of section 6, and calculate predicted probabilities, now with estimates of uncertainty. Recall the Banks and Hicks data include the following variables below. We add <code>partyid</code> as a variable for this analysis.</p>
<ul>
<li><code>abtrace1</code>: 1= if the respondent thought the ad was about race. 0= otherwise</li>
<li><code>condition2</code>: 1= respondent in the implicit condition. 2= respondent in one of four explicit racism conditions.</li>
<li><code>racresent</code>: a 0 to 1 numeric variable measuring racial resentment</li>
<li><code>oldfash</code>: a 0 to 1 numeric variable measuring “old-fashioned racism”</li>
<li><code>trumvote</code>: 1= respondent has vote preference for Trump 0=otherwise</li>
<li><code>partyid</code>: A 1 to 7 numeric variables indicating partisanship from strong Democrat to strong Republican. Below 4 is a Democrat/Democratic leaner, above 4 is a Republican/Republican leaner.</li>
</ul>
<p>Let’s load the data again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages("rio")</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rio)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>study <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"https://github.com/ktmccabe/teachingdata/blob/main/ssistudyrecode.dta?raw=true"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s set the experiment aside for now and focus on vote choice as the outcome: <code>trumvote.</code> Let’s suppose we were interested in understanding whether partisanship influences vote choice.</p>
<ul>
<li>What would be a simple regression model we could run? (e.g., what would be on the left, what would be on the right?)</li>
<li>What type of model should it be? (e.g., OLS, glm, logit, probit, etc.?)</li>
<li>Run this model below</li>
<li>What do you conclude about the influence of party on vote choice?</li>
</ul>
<details>
<summary>
Try on your own, then expand for one solution.
</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(trumvote <span class="sc">~</span> partyid, <span class="at">data=</span>study, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"probit"</span>))</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(texreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Version:  1.38.6
Date:     2022-04-06
Author:   Philip Leifeld (University of Essex)

Consider submitting praise using the praise or praise_interactive functions.
Please cite the JSS article in your publications -- see citation("texreg").</code></pre>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>texreg<span class="sc">::</span><span class="fu">knitreg</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
Model 1
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
(Intercept)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-2.06<sup>***</sup>
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.13)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
partyid
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.43<sup>***</sup>
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.03)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
AIC
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1056.38
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
BIC
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1066.23
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Log Likelihood
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-526.19
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Deviance
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1052.38
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
1019
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="2">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>

</table>
<p>We took a probit approach. What other approaches could we have taken?</p>
</details>
<p>In a <code>glm</code> model, we have to make a leap from a probit/logit coefficient to vaguely answer our research question. What we want to do instead, is become more focused in our research questions, hypotheses, and estimations to generate precise quantities of interest that speak directly to our theoretical questions.</p>
<p>Let’s try this again. Let’s be more focused in our question/hypothesis.</p>
<ul>
<li>As people shift from strong Democrats to strong Republicans, how does their probability of voting for Trump change?</li>
<li>How can we transform our model from before into quantities that speak directly to this question?</li>
</ul>
<details>
<summary>
Computing probabilities.
</summary>
<p>We only have one covariate, so this becomes an easier problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>newdata.party <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">partyid =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Set type to be response</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>results1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit1, <span class="at">newdata =</span> newdata.party, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.0512844</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.1147444</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.2204047</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.3669367</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.5362029</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.6990679</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.8295963</td>
</tr>
</tbody>
</table>
</div>
</div>
</details>
<p>How can we best communicate this to our readers?</p>
<details>
<summary>
Computing probabilities.
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">y=</span>results1,</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Predicted probability by partisanship"</span>,</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"b"</span>,</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Partisanship: Strong Dem to Strong Rep"</span>,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Predicted Probability"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>ggres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">probs=</span>results1, <span class="at">partisanship=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ggres, <span class="fu">aes</span>(<span class="at">x=</span>partisanship, <span class="at">y=</span>probs))<span class="sc">+</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Partisanship: Strong Dem to Strong Rep"</span>)<span class="sc">+</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Predicted Probability"</span>)<span class="sc">+</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted probability by partisanship"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-43-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
<p>How can we improve this even further?</p>
<ul>
<li>Calculate uncertainty!</li>
</ul>
<p>Again, because we only have one covariate, the process is a little more simple. Let’s use the <code>predict</code> function to calculate the standard errors for us on the <code>link</code> scale with <code>se.fit = T</code> and then construct our own confidence intervals.</p>
<details>
<summary>
Try on your own, then expand for the solution.
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>results1.link <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit1, <span class="at">newdata=</span>newdata.party, <span class="at">type=</span><span class="st">"link"</span>, <span class="at">se.fit=</span>T)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>results1.link</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fit
         1          2          3          4          5          6          7 
-1.6325260 -1.2016765 -0.7708270 -0.3399775  0.0908720  0.5217215  0.9525710 

$se.fit
         1          2          3          4          5          6          7 
0.10002223 0.07628414 0.05617531 0.04487352 0.04892006 0.06553079 0.08784628 

$residual.scale
[1] 1</code></pre>
</div>
</div>
<p>Now for each value, we get the standard error estimate. We now have to convert these to the response scale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>m.results <span class="ot">&lt;-</span>  <span class="fu">pnorm</span>(results1.link<span class="sc">$</span>fit)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>results1.lb <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(results1.link<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>results1.link<span class="sc">$</span>se.fit)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>results1.ub <span class="ot">&lt;-</span><span class="fu">pnorm</span>(results1.link<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>)<span class="sc">*</span>results1.link<span class="sc">$</span>se.fit)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's look at the results from the original point estimates and this approach</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(results1, m.results, results1.lb, results1.ub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    results1  m.results results1.lb results1.ub
1 0.05128436 0.05128436  0.03373233  0.07543205
2 0.11474445 0.11474445  0.08831718  0.14636254
3 0.22040474 0.22040474  0.18917824  0.25439421
4 0.36693674 0.36693674  0.33435178  0.40051009
5 0.53620285 0.53620285  0.49800149  0.57407307
6 0.69906787 0.69906787  0.65294495  0.74220540
7 0.82959626 0.82959626  0.78242093  0.86965177</code></pre>
</div>
</div>
<p>Finally, let’s add it to our plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">y=</span>results1,</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Predicted probability by partisanship"</span>,</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"b"</span>,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Partisanship: Strong Dem to Strong Rep"</span>,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Predicted Probability"</span>)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">y=</span> results1.ub, <span class="at">type=</span><span class="st">"l"</span>)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">y=</span> results1.lb, <span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>ggres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(m.results, results1.lb, results1.ub), <span class="at">partisanship=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ggres, <span class="fu">aes</span>(<span class="at">x=</span>partisanship, <span class="at">y=</span>m.results))<span class="sc">+</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_ribbon(aes(ymin=results1.lb, ymax=results1.ub), alpha=.5)+</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>results1.lb, <span class="at">ymax=</span>results1.ub), <span class="at">width=</span>.<span class="dv">02</span>)<span class="sc">+</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Partisanship: Strong Dem to Strong Rep"</span>)<span class="sc">+</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Predicted Probability"</span>)<span class="sc">+</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Predicted probability by partisanship"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-46-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
<p>The <code>marginaleffects</code> and <code>prediction</code> packages in R will give us a shortcut by calculating the confidence intervals for us. We can repeat the previous process inside these functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("marginaleffects")</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>pred.resultsme <span class="ot">&lt;-</span> <span class="fu">avg_predictions</span>(fit1,  <span class="at">type =</span> <span class="st">"response"</span>,<span class="at">by =</span> <span class="st">"partyid"</span>, <span class="at">newdata =</span> <span class="fu">datagridcf</span>(<span class="at">partyid =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">partyid</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">s.value</th>
<th style="text-align: right;">conf.low</th>
<th style="text-align: right;">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0512844</td>
<td style="text-align: right;">0.0105264</td>
<td style="text-align: right;">4.871990</td>
<td style="text-align: right;">1.1e-06</td>
<td style="text-align: right;">19.78779</td>
<td style="text-align: right;">0.0306531</td>
<td style="text-align: right;">0.0719157</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.1147444</td>
<td style="text-align: right;">0.0147835</td>
<td style="text-align: right;">7.761643</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">46.76136</td>
<td style="text-align: right;">0.0857693</td>
<td style="text-align: right;">0.1437196</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.2204047</td>
<td style="text-align: right;">0.0166507</td>
<td style="text-align: right;">13.236974</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">130.45307</td>
<td style="text-align: right;">0.1877700</td>
<td style="text-align: right;">0.2530395</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.3669367</td>
<td style="text-align: right;">0.0168967</td>
<td style="text-align: right;">21.716505</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">344.96174</td>
<td style="text-align: right;">0.3338199</td>
<td style="text-align: right;">0.4000536</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.5362029</td>
<td style="text-align: right;">0.0194359</td>
<td style="text-align: right;">27.588317</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">554.14221</td>
<td style="text-align: right;">0.4981093</td>
<td style="text-align: right;">0.5742965</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.6990679</td>
<td style="text-align: right;">0.0228165</td>
<td style="text-align: right;">30.638670</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">682.41374</td>
<td style="text-align: right;">0.6543483</td>
<td style="text-align: right;">0.7437874</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.8295963</td>
<td style="text-align: right;">0.0222636</td>
<td style="text-align: right;">37.262409</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">1007.12816</td>
<td style="text-align: right;">0.7859604</td>
<td style="text-align: right;">0.8732322</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("prediction")</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prediction)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="do">## prediction can take a new dataframe or specific values of covariates</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>pred.results <span class="ot">&lt;-</span> <span class="fu">prediction</span>(fit1, <span class="at">at=</span><span class="fu">list</span>(<span class="at">partyid =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="at">type=</span><span class="st">"response"</span>, <span class="at">calculate_se =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pred.results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output-display">
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 15%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 11%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">at(partyid)</th>
<th style="text-align: right;">Prediction</th>
<th style="text-align: right;">SE</th>
<th style="text-align: right;">z</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">lower</th>
<th style="text-align: right;">upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0512844</td>
<td style="text-align: right;">0.0105264</td>
<td style="text-align: right;">4.871990</td>
<td style="text-align: right;">1.1e-06</td>
<td style="text-align: right;">0.0306531</td>
<td style="text-align: right;">0.0719157</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.1147444</td>
<td style="text-align: right;">0.0147835</td>
<td style="text-align: right;">7.761644</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">0.0857693</td>
<td style="text-align: right;">0.1437196</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.2204047</td>
<td style="text-align: right;">0.0166507</td>
<td style="text-align: right;">13.236974</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">0.1877700</td>
<td style="text-align: right;">0.2530395</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.3669367</td>
<td style="text-align: right;">0.0168967</td>
<td style="text-align: right;">21.716505</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">0.3338199</td>
<td style="text-align: right;">0.4000536</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.5362029</td>
<td style="text-align: right;">0.0194359</td>
<td style="text-align: right;">27.588317</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">0.4981093</td>
<td style="text-align: right;">0.5742965</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.6990679</td>
<td style="text-align: right;">0.0228165</td>
<td style="text-align: right;">30.638670</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">0.6543483</td>
<td style="text-align: right;">0.7437874</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.8295963</td>
<td style="text-align: right;">0.0222636</td>
<td style="text-align: right;">37.262407</td>
<td style="text-align: right;">0.0e+00</td>
<td style="text-align: right;">0.7859604</td>
<td style="text-align: right;">0.8732322</td>
</tr>
</tbody>
</table>
</div>
<p>When we have covariates, we have a few more decisions to make about how to calculate quantities of interest and how to compute uncertainty. Let’s amend our model to include additional covariates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(trumvote <span class="sc">~</span> partyid <span class="sc">+</span> racresent <span class="sc">+</span> oldfash, <span class="at">data=</span>study, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"probit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we have the same research question, but we have covariates. We have to decide how we want to calculate the predicted probabilities of voting for Trump at different levels of partisanship.</p>
<ul>
<li>Where should we set <code>racresent</code> and <code>oldfash</code> when computing these values?</li>
</ul>
<p>Let’s suppose we want to hold them at observed values. This means we will calculate the average predicted probability of voting for Trump at each value of partisanship, holding the other covariates at observed values.</p>
<p>We can do this in a few ways.</p>
<p>Here, let’s do this manually:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit2)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="do">## party id 1</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>X<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fit2)</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>X<span class="fl">.1</span>[, <span class="st">"partyid"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>p<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(X<span class="fl">.1</span> <span class="sc">%*%</span> bh)</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>p.<span class="fl">1.</span>mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(p<span class="fl">.1</span>)</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="do">## party id 2</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>X<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fit2)</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>X<span class="fl">.2</span>[, <span class="st">"partyid"</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>p<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(X<span class="fl">.2</span> <span class="sc">%*%</span> bh)</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>p.<span class="fl">2.</span>mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(p<span class="fl">.2</span>)</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a><span class="do">## More efficient approach 1:</span></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>p.means <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">7</span>)</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>){</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fit2)</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>  X[, <span class="st">"partyid"</span>] <span class="ot">&lt;-</span> i</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(X <span class="sc">%*%</span> bh)</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>  p.means[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(p)</span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a><span class="do">## More efficient approach 2:</span></span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>myest <span class="ot">&lt;-</span> <span class="cf">function</span>(value){</span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fit2)</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>  X[, <span class="st">"partyid"</span>] <span class="ot">&lt;-</span> value</span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(X <span class="sc">%*%</span> bh)</span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>  p.mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(p)</span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p.mean)</span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>p.means <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, myest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or, we can use <code>marginaleffects</code> or <code>prediction</code> again.</p>
<p>How would you apply <code>marginaleffects</code>? Below is the code from the <code>prediction</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>pred.results2 <span class="ot">&lt;-</span> <span class="fu">prediction</span>(fit2, <span class="at">at=</span><span class="fu">list</span>(<span class="at">partyid =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s compare the output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(p.means, <span class="fu">summary</span>(pred.results2)<span class="sc">$</span>Prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        p.means           
[1,] 0.08296357 0.08296357
[2,] 0.14824083 0.14824083
[3,] 0.24098759 0.24098759
[4,] 0.35835987 0.35835987
[5,] 0.49072437 0.49072437
[6,] 0.62383575 0.62383575
[7,] 0.74331307 0.74331307</code></pre>
</div>
</div>
<p>What if we want uncertainty?</p>
<ul>
<li>We can bootstrap or simulate confidence intervals around each quantity of interest, or use a function to do this for us.</li>
</ul>
<details>
<summary>
Bootstrap Details
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 1: sample new rows of the data and subset</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>wrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(study), <span class="at">size =</span> <span class="fu">nrow</span>(study), <span class="at">replace =</span> T)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> study[wrows, ]</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2: run your regression model with the new data</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>boot.probit <span class="ot">&lt;-</span><span class="fu">glm</span>(trumvote <span class="sc">~</span> partyid <span class="sc">+</span> racresent <span class="sc">+</span> oldfash, </span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>subdata, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"probit"</span>))</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 3: generate average predicted probability</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>Xboot <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(boot.probit)</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>Xboot[, <span class="st">"partyid"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot.probit)</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>p.boot <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">pnorm</span>(Xboot <span class="sc">%*%</span> Bh))</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 4: wrap it in a function, make data generic</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>myboot <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>  wrows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), <span class="at">size =</span> <span class="fu">nrow</span>(df), <span class="at">replace =</span> T)</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> df[wrows, ]</span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>  boot.probit <span class="ot">&lt;-</span><span class="fu">glm</span>(trumvote <span class="sc">~</span> partyid <span class="sc">+</span> racresent <span class="sc">+</span> oldfash, </span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>subdata, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"probit"</span>))</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>  Xboot <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(boot.probit)</span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>  Xboot[, <span class="st">"partyid"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>  Bh <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot.probit)</span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>  p.boot <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">pnorm</span>(Xboot <span class="sc">%*%</span> Bh))</span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p.boot)</span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 5: Uncomment and replicate 1000 times</span></span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a><span class="co">#bestimates.party1 &lt;- replicate(1000, myboot(study))</span></span>
<span id="cb131-30"><a href="#cb131-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-31"><a href="#cb131-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract confidence interval</span></span>
<span id="cb131-32"><a href="#cb131-32" aria-hidden="true" tabindex="-1"></a><span class="co">#quantile(bestimates.party1, c(0.025, .975))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We would then repeat this for each partyid value. Alternatively, we could use <code>prediction</code>!</p>
</details>
</section>
<section id="putting-everything-together" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="putting-everything-together"><span class="header-section-number">7.7</span> Putting everything together</h2>
<p>Recall, we can take something that looks like column 5 in the table from Antoine Banks and Heather Hicks example from the previous section and move it into a figure, as the authors did.</p>
<p><img src="images/bankstable1.png" class="img-fluid" style="width:40.0%"> <img src="images/abtracefig.png" class="img-fluid" style="width:40.0%"></p>
<p>Let’s run the model from column 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>fit.probit5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(abtrace1 <span class="sc">~</span> <span class="fu">factor</span>(condition2)<span class="sc">*</span>racresent </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>                   <span class="sc">+</span> <span class="fu">factor</span>(condition2)<span class="sc">*</span>oldfash,</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>study, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"probit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s generate predicted probabilities for thinking the ad is about race across levels of racial resentment in the sample, for people in the implicit and explicit conditions, holding all covariates at observed values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prediction)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>pr.imp <span class="ot">&lt;-</span> <span class="fu">prediction</span>(fit.probit5, <span class="at">at=</span> <span class="fu">list</span>(<span class="at">racresent =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>,.<span class="dv">0625</span>),</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">condition2=</span><span class="dv">1</span>),</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">calculate_se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Let's store the summary output this time</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a><span class="do">## And to make it easier to plot, we'll store as dataframe</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>pr.imp.df <span class="ot">&lt;-</span> <span class="fu">summary</span>(pr.imp)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>pr.exp <span class="ot">&lt;-</span> <span class="fu">prediction</span>(fit.probit5, <span class="at">at=</span> <span class="fu">list</span>(<span class="at">racresent =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>,.<span class="dv">0625</span>),</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">condition2=</span><span class="dv">2</span>),</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">calculate_se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>pr.exp.df <span class="ot">&lt;-</span> <span class="fu">summary</span>(pr.exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can peek inside <code>pr.imp.df</code> to see the format of the output.</p>
<p>Let’s now visualize! We will try to stay true to the authors’ visual choices here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot results</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span>pr.imp.df<span class="sc">$</span><span class="st">`</span><span class="at">at(racresent)</span><span class="st">`</span>, <span class="at">y=</span>pr.imp.df<span class="sc">$</span>Prediction, </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>,</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">lty=</span><span class="dv">2</span>,</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Racial Resentment"</span>,</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Predicted Probability of Viewing the Ad as about Race"</span>,</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.main =</span> .<span class="dv">7</span>)</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="do">## add explicit point values</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>pr.exp.df<span class="sc">$</span><span class="st">`</span><span class="at">at(racresent)</span><span class="st">`</span>, <span class="at">y=</span>pr.exp.df<span class="sc">$</span>Prediction, <span class="at">type=</span><span class="st">"l"</span>)</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="do">## add additional lines for the upper and lower confidence intervals</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>pr.exp.df<span class="sc">$</span><span class="st">`</span><span class="at">at(racresent)</span><span class="st">`</span>, <span class="at">y=</span>pr.exp.df<span class="sc">$</span>lower, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>pr.exp.df<span class="sc">$</span><span class="st">`</span><span class="at">at(racresent)</span><span class="st">`</span>, <span class="at">y=</span>pr.exp.df<span class="sc">$</span>upper, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>pr.imp.df<span class="sc">$</span><span class="st">`</span><span class="at">at(racresent)</span><span class="st">`</span>, <span class="at">y=</span>pr.imp.df<span class="sc">$</span>lower, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="at">x=</span>pr.imp.df<span class="sc">$</span><span class="st">`</span><span class="at">at(racresent)</span><span class="st">`</span>, <span class="at">y=</span>pr.imp.df<span class="sc">$</span>upper, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Legend</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">lty=</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>, <span class="dv">3</span>,<span class="dv">1</span>), </span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">"Implicit"</span>, <span class="st">"Explicit"</span>, </span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Implicit 95% CI"</span>, <span class="st">"Explicit 95% CI"</span>), <span class="at">cex=</span>.<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s combine the two dataframes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>pr.comb <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pr.imp.df, pr.exp.df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pr.comb, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">at(racresent)</span><span class="st">`</span>, </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y=</span> Prediction, </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color=</span><span class="fu">as.factor</span>(<span class="st">`</span><span class="at">at(condition2)</span><span class="st">`</span>)))<span class="sc">+</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">fill=</span><span class="fu">as.factor</span>(<span class="st">`</span><span class="at">at(condition2)</span><span class="st">`</span>)), <span class="at">alpha=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Racial Resentment"</span>)<span class="sc">+</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">"Condition"</span>,</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Implicit"</span>, <span class="st">"Explicit"</span>))<span class="sc">+</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name=</span><span class="st">"Condition"</span>,</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Implicit"</span>, <span class="st">"Explicit"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We could instead show the <strong><em>difference</em></strong> between the conditions across levels of racial resentment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(margins)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>marest <span class="ot">&lt;-</span> <span class="fu">margins</span>(fit.probit5, <span class="at">at=</span> <span class="fu">list</span>(<span class="at">racresent =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>,.<span class="dv">0625</span>)),</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">variables=</span><span class="st">"condition2"</span>,</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">change =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">vce=</span><span class="st">"delta"</span>,</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Store summary as dataframe</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>marest.df <span class="ot">&lt;-</span> <span class="fu">summary</span>(marest)</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="do">## plot res</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(marest.df, <span class="fu">aes</span>(<span class="at">x=</span>racresent, <span class="at">y=</span>AME))<span class="sc">+</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper), <span class="at">alpha=</span>.<span class="dv">5</span>, <span class="at">width=</span><span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Racial Resentment"</span>)<span class="sc">+</span></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"AME: Explicit - Implicit Condition on Pr(Ad About Race)"</span>)<span class="sc">+</span></span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-QuantitiesofInterest_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-BinaryOutcomes.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Binary Dependent Variables</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-OrdinalandOutcomes.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Ordinal Outcomes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>